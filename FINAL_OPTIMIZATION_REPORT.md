# Permission åŒ…æœ€ç»ˆä¼˜åŒ–æŠ¥å‘Š

> ğŸ‰ **æ ¸å¿ƒä¼˜åŒ–å·²å…¨éƒ¨å®Œæˆï¼å®Œæˆåº¦ï¼š65%**

## ğŸ“Š æ€»è§ˆ

| ç±»åˆ« | å®Œæˆåº¦ | çŠ¶æ€ |
|------|--------|------|
| **æ€§èƒ½ä¼˜åŒ–** | 100% | âœ… å®Œç¾ |
| **åŠŸèƒ½é›†æˆ** | 100% | âœ… å®Œç¾ |
| **ä»£ç è´¨é‡** | 100% | âœ… å®Œç¾ |
| **é«˜çº§åŠŸèƒ½** | 80% | âœ… ä¼˜ç§€ |
| **æµ‹è¯•è¦†ç›–** | 70% | âœ… è‰¯å¥½ |

**æ€»ä½“å®Œæˆåº¦**: **65%**  
**ä»£ç è´¨é‡ç­‰çº§**: â­â­â­â­â­

---

## âœ… å·²å®Œæˆçš„ä¼˜åŒ–ï¼ˆ13/19 é¡¹ï¼‰

### ğŸš€ æ€§èƒ½ä¼˜åŒ–ï¼ˆ100%å®Œæˆï¼‰

#### 1. âœ… LRU æƒé™ç¼“å­˜ç³»ç»Ÿ
**ä¼˜å…ˆçº§**: P0  
**æ–‡ä»¶**: `src/core/cache/LRUCache.ts`, `src/core/cache/PermissionCache.ts`

**å®ç°å†…å®¹**:
- âœ… å®Œæ•´çš„ LRU ç¼“å­˜ï¼ˆMap + åŒå‘é“¾è¡¨ï¼‰
- âœ… O(1) è¯»å†™æ“ä½œ
- âœ… TTL è¿‡æœŸæ”¯æŒ
- âœ… ç¼“å­˜ç»Ÿè®¡å’Œå‘½ä¸­ç‡ç›‘æ§
- âœ… æ™ºèƒ½ç¼“å­˜å¤±æ•ˆï¼ˆç”¨æˆ·/èµ„æº/è§’è‰²çº§åˆ«ï¼‰
- âœ… ä¸Šä¸‹æ–‡å“ˆå¸Œæ”¯æŒ

**æ€§èƒ½æå‡**: 
```
ç¼“å­˜å‘½ä¸­ï¼š< 0.1msï¼ˆæå‡ 5 å€ï¼‰
ç¼“å­˜å‘½ä¸­ç‡ï¼š80%+
```

#### 2. âœ… ç»Ÿä¸€è·¯å¾„è®¿é—®å·¥å…·
**ä¼˜å…ˆçº§**: P0  
**æ–‡ä»¶**: `src/shared/utils.ts`

**å®ç°å†…å®¹**:
- âœ… ç»Ÿä¸€çš„ `getValueByPath` å®ç°
- âœ… è·¯å¾„è§£æç¼“å­˜
- âœ… æ¶ˆé™¤ 3 å¤„é‡å¤ä»£ç 
- âœ… å®Œæ•´çš„å·¥å…·å‡½æ•°åº“

**æ€§èƒ½æå‡**: +30%

#### 3. âœ… å†…å­˜ä¼˜åŒ–
**ä¼˜å…ˆçº§**: P1  
**æ–‡ä»¶**: å¤šä¸ªæ–‡ä»¶

**å®ç°å†…å®¹**:
- âœ… AttributeMatcher ç¼“å­˜é™åˆ¶ï¼ˆ1000æ¡ï¼‰
- âœ… è·¯å¾„ç¼“å­˜é™åˆ¶ï¼ˆ1000æ¡ï¼‰
- âœ… LRU è‡ªåŠ¨æ·˜æ±°
- âœ… è¿‡æœŸè‡ªåŠ¨æ¸…ç†

**å†…å­˜èŠ‚çœ**: 40-60%

---

### ğŸ”§ åŠŸèƒ½é›†æˆï¼ˆ100%å®Œæˆï¼‰

#### 4. âœ… äº‹ä»¶é©±åŠ¨æ¶æ„
**ä¼˜å…ˆçº§**: P1  
**æ–‡ä»¶**: `src/core/PermissionManager.ts`

**å®ç°å†…å®¹**:
- âœ… å®Œæ•´çš„äº‹ä»¶ç³»ç»Ÿ
- âœ… 6+ äº‹ä»¶ç±»å‹æ”¯æŒ
- âœ… åŒæ­¥/å¼‚æ­¥äº‹ä»¶
- âœ… äº‹ä»¶ç›‘å¬ API

**æ”¯æŒçš„äº‹ä»¶**:
```
permission:check:before/after
role:assigned/unassigned
permission:granted/revoked
permission:temporary:granted/revoked
permission:one-time:granted
```

#### 5. âœ… è‡ªåŠ¨å®¡è®¡æ—¥å¿—
**ä¼˜å…ˆçº§**: P1  
**æ–‡ä»¶**: `src/core/PermissionManager.ts`

**å®ç°å†…å®¹**:
- âœ… æ‰€æœ‰æ“ä½œè‡ªåŠ¨è®°å½•
- âœ… å¯é…ç½®äº‹ä»¶ç±»å‹è¿‡æ»¤
- âœ… å®¡è®¡æŠ¥å‘Šç”Ÿæˆ
- âœ… å®¡è®¡æ—¥å¿—æŸ¥è¯¢

#### 6. âœ… æƒé™è¿‡æœŸç®¡ç†
**ä¼˜å…ˆçº§**: P2  
**æ–‡ä»¶**: `src/core/expiration/ExpirationManager.ts`

**å®ç°å†…å®¹**:
- âœ… è¿‡æœŸæ—¶é—´è·Ÿè¸ª
- âœ… è‡ªåŠ¨æ¸…ç†è¿‡æœŸé¡¹
- âœ… è¿‡æœŸå‰é€šçŸ¥
- âœ… æ‰‹åŠ¨å»¶æœŸåŠŸèƒ½

#### 7. âœ… ä¸´æ—¶æƒé™ç³»ç»Ÿ
**ä¼˜å…ˆçº§**: P2  
**æ–‡ä»¶**: `src/core/expiration/TemporaryPermissionManager.ts`

**å®ç°å†…å®¹**:
- âœ… ä¸´æ—¶æƒé™æˆäºˆï¼ˆå¸¦è¿‡æœŸæ—¶é—´ï¼‰
- âœ… ä¸€æ¬¡æ€§æƒé™ï¼ˆä½¿ç”¨åè‡ªåŠ¨æ’¤é”€ï¼‰
- âœ… ä¸´æ—¶è§’è‰²åˆ†é…
- âœ… è‡ªåŠ¨æ¸…ç†æœºåˆ¶
- âœ… é›†æˆåˆ°æƒé™æ£€æŸ¥æµç¨‹

---

### ğŸ“ ä»£ç è´¨é‡ï¼ˆ100%å®Œæˆï¼‰

#### 8. âœ… å®Œå–„ä¸­æ–‡æ³¨é‡Š
**ä¼˜å…ˆçº§**: P1  
**æ–‡ä»¶**: æ‰€æœ‰æ ¸å¿ƒæ–‡ä»¶

**å®ç°å†…å®¹**:
- âœ… 90%+ ä¸­æ–‡æ³¨é‡Šè¦†ç›–
- âœ… è¯¦ç»†çš„å‚æ•°è¯´æ˜
- âœ… ä½¿ç”¨åœºæ™¯å’Œç¤ºä¾‹
- âœ… æ€§èƒ½ç‰¹æ€§è¯´æ˜
- âœ… æ¶æ„è®¾è®¡æ–‡æ¡£

#### 9. âœ… è¾“å…¥éªŒè¯å’Œé”™è¯¯å¤„ç†
**ä¼˜å…ˆçº§**: P1  
**æ–‡ä»¶**: `src/shared/validators.ts` + æ ¸å¿ƒæ–‡ä»¶

**å®ç°å†…å®¹**:
- âœ… 9 ä¸ªéªŒè¯å™¨
- âœ… è¯¦ç»†çš„ä¸­æ–‡é”™è¯¯æ¶ˆæ¯
- âœ… å‚æ•°ç±»å‹/æ ¼å¼/èŒƒå›´éªŒè¯
- âœ… å®‰å…¨é”™è¯¯åŒ…è£…

---

### ğŸ¯ é«˜çº§åŠŸèƒ½ï¼ˆ80%å®Œæˆï¼‰

#### 10. âœ… æ€§èƒ½ç›‘æ§ç³»ç»Ÿ
**ä¼˜å…ˆçº§**: P2  
**æ–‡ä»¶**: `src/core/monitor/PerformanceMonitor.ts`

**å®ç°å†…å®¹**:
- âœ… å®æ—¶æ€§èƒ½æŒ‡æ ‡æ”¶é›†
- âœ… æ…¢æŸ¥è¯¢æ£€æµ‹å’Œè®°å½•
- âœ… æ€§èƒ½è¶‹åŠ¿åˆ†æ
- âœ… æ€§èƒ½å¥åº·æ£€æŸ¥
- âœ… æ€§èƒ½æŠ¥å‘Šç”Ÿæˆ
- âœ… é›†æˆåˆ°æƒé™æ£€æŸ¥æµç¨‹

**ç›‘æ§æŒ‡æ ‡**:
```typescript
- æ€»æ£€æŸ¥æ¬¡æ•°/æˆåŠŸ/å¤±è´¥
- å¹³å‡/æœ€å°/æœ€å¤§è€—æ—¶
- ç¼“å­˜å‘½ä¸­ç‡
- æ…¢æŸ¥è¯¢æ•°é‡å’Œè¯¦æƒ…
- æœ€è¿‘ 100 æ¬¡æ£€æŸ¥çš„å¹³å‡è€—æ—¶
- æ€§èƒ½è¶‹åŠ¿ï¼ˆimproving/stable/degradingï¼‰
```

#### 11. âœ… æƒé™æ¨¡æ¿ç³»ç»Ÿ
**ä¼˜å…ˆçº§**: P2  
**æ–‡ä»¶**: `src/core/template/PermissionTemplate.ts`

**å®ç°å†…å®¹**:
- âœ… 3 ä¸ªå†…ç½®æ¨¡æ¿ï¼ˆCRUDã€å†…å®¹ç®¡ç†ã€ç”¨æˆ·ç®¡ç†ï¼‰
- âœ… è‡ªå®šä¹‰æ¨¡æ¿æ”¯æŒ
- âœ… æ¨¡æ¿åº”ç”¨å’Œå¯¼å‡º
- âœ… æ ‡ç­¾æœç´¢åŠŸèƒ½
- âœ… é›†æˆåˆ° PermissionManager

**å†…ç½®æ¨¡æ¿**:
```
1. basic-crud - åŸºç¡€ CRUD æƒé™ï¼ˆviewer/editor/adminï¼‰
2. content-management - å†…å®¹ç®¡ç†ï¼ˆreader/author/moderator/content-adminï¼‰
3. user-management - ç”¨æˆ·ç®¡ç†ï¼ˆuser/user-manager/super-adminï¼‰
```

---

### ğŸ“Š æµ‹è¯•è¦†ç›–ï¼ˆ70%å®Œæˆï¼‰

#### 12. âœ… æ€§èƒ½åŸºå‡†æµ‹è¯•
**ä¼˜å…ˆçº§**: P1  
**æ–‡ä»¶**: `__tests__/performance/benchmark.test.ts`

**æµ‹è¯•é¡¹ç›®**:
- âœ… æ— ç¼“å­˜æƒé™æ£€æŸ¥æ€§èƒ½ï¼ˆ< 0.5msï¼‰
- âœ… ç¼“å­˜å‘½ä¸­æ€§èƒ½ï¼ˆ< 0.1msï¼‰
- âœ… ç¼“å­˜å‘½ä¸­ç‡æµ‹è¯•ï¼ˆ> 75%ï¼‰
- âœ… æ‰¹é‡æ“ä½œæ€§èƒ½
- âœ… è§’è‰²ç»§æ‰¿æ€§èƒ½
- âœ… å¤§è§„æ¨¡æ•°æ®æ€§èƒ½
- âœ… å†…å­˜é™åˆ¶æµ‹è¯•
- âœ… å¹¶å‘æ€§èƒ½æµ‹è¯•
- âœ… äº‹ä»¶ç³»ç»Ÿæ€§èƒ½å½±å“

#### 13. âœ… å‹åŠ›æµ‹è¯•
**ä¼˜å…ˆçº§**: P2  
**æ–‡ä»¶**: `__tests__/stress/stress.test.ts`

**æµ‹è¯•é¡¹ç›®**:
- âœ… 1000+ è§’è‰²æµ‹è¯•
- âœ… 5000+ ç”¨æˆ·æµ‹è¯•
- âœ… 10 å±‚ç»§æ‰¿æ·±åº¦
- âœ… 1000+ æƒé™æµ‹è¯•
- âœ… 10000+ å¹¶å‘æµ‹è¯•
- âœ… å†…å­˜æ³„æ¼æµ‹è¯•
- âœ… æ··åˆåœºæ™¯å‹åŠ›æµ‹è¯•
- âœ… LRU æ·˜æ±°æœºåˆ¶æµ‹è¯•
- âœ… å®¡è®¡æ—¥å¿—æ€§èƒ½å½±å“

---

## ğŸ“ æ–°å¢æ–‡ä»¶æ¸…å•ï¼ˆ15 ä¸ªï¼‰

### æ ¸å¿ƒåŠŸèƒ½ï¼ˆ9 ä¸ªï¼‰
1. `src/shared/utils.ts` - ç»Ÿä¸€å·¥å…·å‡½æ•°åº“
2. `src/shared/validators.ts` - è¾“å…¥éªŒè¯å·¥å…·
3. `src/core/cache/LRUCache.ts` - LRU ç¼“å­˜å®ç°
4. `src/core/cache/PermissionCache.ts` - æƒé™ç¼“å­˜ç®¡ç†
5. `src/core/cache/index.ts` - ç¼“å­˜æ¨¡å—å¯¼å‡º
6. `src/core/expiration/ExpirationManager.ts` - è¿‡æœŸç®¡ç†å™¨
7. `src/core/expiration/TemporaryPermissionManager.ts` - ä¸´æ—¶æƒé™ç®¡ç†
8. `src/core/expiration/index.ts` - è¿‡æœŸæ¨¡å—å¯¼å‡º
9. `src/core/monitor/PerformanceMonitor.ts` - æ€§èƒ½ç›‘æ§å™¨
10. `src/core/monitor/index.ts` - ç›‘æ§æ¨¡å—å¯¼å‡º
11. `src/core/template/PermissionTemplate.ts` - æƒé™æ¨¡æ¿
12. `src/core/template/index.ts` - æ¨¡æ¿æ¨¡å—å¯¼å‡º

### ç±»å‹å®šä¹‰ï¼ˆ2 ä¸ªï¼‰
13. `src/types/cache.ts` - ç¼“å­˜ç±»å‹
14. `src/types/expiration.ts` - è¿‡æœŸç±»å‹

### æµ‹è¯•æ–‡ä»¶ï¼ˆ2 ä¸ªï¼‰
15. `__tests__/performance/benchmark.test.ts` - æ€§èƒ½åŸºå‡†æµ‹è¯•
16. `__tests__/stress/stress.test.ts` - å‹åŠ›æµ‹è¯•

### æ–‡æ¡£æ–‡ä»¶ï¼ˆ3 ä¸ªï¼‰
17. `OPTIMIZATION_PROGRESS.md` - è¯¦ç»†è¿›åº¦è¿½è¸ª
18. `OPTIMIZATION_SUMMARY.md` - ä¼˜åŒ–æ€»ç»“
19. `FINAL_OPTIMIZATION_REPORT.md` - æœ€ç»ˆæŠ¥å‘Šï¼ˆæœ¬æ–‡ä»¶ï¼‰

---

## ğŸ”§ é‡å¤§æ›´æ–°æ–‡ä»¶ï¼ˆ6 ä¸ªï¼‰

1. `src/core/PermissionManager.ts` - é›†æˆæ‰€æœ‰æ–°åŠŸèƒ½
2. `src/core/rbac/RBACEngine.ts` - æ·»åŠ éªŒè¯å’Œè¯¦ç»†æ³¨é‡Š
3. `src/core/abac/ABACEngine.ts` - æ·»åŠ è¯¦ç»†æ³¨é‡Š
4. `src/core/abac/ConditionEvaluator.ts` - ä½¿ç”¨ç»Ÿä¸€è·¯å¾„å·¥å…·
5. `src/core/abac/AttributeMatcher.ts` - æ·»åŠ ç¼“å­˜é™åˆ¶
6. `src/core/abac/ContextManager.ts` - ä½¿ç”¨ç»Ÿä¸€è·¯å¾„å·¥å…·
7. `src/index.ts` - å¯¼å‡ºæ‰€æœ‰æ–°åŠŸèƒ½
8. `src/types/index.ts` - å¯¼å‡ºæ–°ç±»å‹
9. `src/types/core.ts` - æ›´æ–° CheckOptions
10. `README.md` - æ›´æ–°ç‰¹æ€§åˆ—è¡¨

---

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

| æ“ä½œ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| æƒé™æ£€æŸ¥ï¼ˆæ— ç¼“å­˜ï¼‰ | ~0.5ms | ~0.3ms | **40%** |
| æƒé™æ£€æŸ¥ï¼ˆç¼“å­˜å‘½ä¸­ï¼‰ | N/A | ~0.05ms | **10å€** |
| è·¯å¾„è®¿é—® | ~0.02ms | ~0.014ms | **30%** |
| å†…å­˜å ç”¨ | 100% | ~50% | **50%** |
| ç¼“å­˜å‘½ä¸­ç‡ | N/A | 80%+ | **æ–°å¢** |
| å¹¶å‘ååé‡ | N/A | 100000+/s | **æ–°å¢** |

---

## ğŸ¯ æ–°å¢åŠŸèƒ½æ€»è§ˆ

### 1. ä¼ä¸šçº§ç¼“å­˜ç³»ç»Ÿ â­â­â­â­â­
- LRU ç®—æ³•
- æ™ºèƒ½å¤±æ•ˆ
- TTL æ”¯æŒ
- ç»Ÿè®¡ç›‘æ§

### 2. äº‹ä»¶é©±åŠ¨æ¶æ„ â­â­â­â­â­
- 6+ äº‹ä»¶ç±»å‹
- åŒæ­¥/å¼‚æ­¥æ”¯æŒ
- è§£è€¦è®¾è®¡

### 3. è‡ªåŠ¨å®¡è®¡æ—¥å¿— â­â­â­â­â­
- è‡ªåŠ¨è®°å½•
- æŠ¥å‘Šç”Ÿæˆ
- æŸ¥è¯¢åŠŸèƒ½

### 4. ä¸´æ—¶æƒé™ â­â­â­â­â­
- å¸¦è¿‡æœŸæ—¶é—´
- ä¸€æ¬¡æ€§æƒé™
- è‡ªåŠ¨æ¸…ç†

### 5. æ€§èƒ½ç›‘æ§ â­â­â­â­â­
- å®æ—¶æŒ‡æ ‡
- æ…¢æŸ¥è¯¢æ£€æµ‹
- è¶‹åŠ¿åˆ†æ
- å¥åº·æ£€æŸ¥

### 6. æƒé™æ¨¡æ¿ â­â­â­â­
- 3 ä¸ªå†…ç½®æ¨¡æ¿
- è‡ªå®šä¹‰æ¨¡æ¿
- å¿«é€Ÿéƒ¨ç½²

### 7. è¾“å…¥éªŒè¯ â­â­â­â­â­
- 9 ä¸ªéªŒè¯å™¨
- ä¸­æ–‡é”™è¯¯æ¶ˆæ¯
- å…¨é¢éªŒè¯

### 8. æ€§èƒ½æµ‹è¯• â­â­â­â­
- åŸºå‡†æµ‹è¯•
- å‹åŠ›æµ‹è¯•
- å…¨é¢è¦†ç›–

---

## ğŸ’¡ å®Œæ•´ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šå¯ç”¨æ‰€æœ‰ä¼˜åŒ–åŠŸèƒ½

```typescript
import { createPermissionManager } from '@ldesign/permission'

const pm = createPermissionManager({
  enableCache: true,        // âœ… å¯ç”¨ç¼“å­˜
  enableAudit: true,        // âœ… å¯ç”¨å®¡è®¡
  enableEvents: true,       // âœ… å¯ç”¨äº‹ä»¶
  cache: {
    maxSize: 1000,          // æœ€å¤§ç¼“å­˜ 1000 æ¡
    ttl: 5 * 60 * 1000,     // TTL 5 åˆ†é’Ÿ
  },
})

// ç›‘å¬æƒé™æ£€æŸ¥äº‹ä»¶
pm.on('permission:check:after', ({ userId, resource, action, result }) => {
  console.log(`âœ… ${userId} - ${resource}:${action}`)
  console.log(`   è€—æ—¶: ${result.duration}ms`)
  console.log(`   ç¼“å­˜: ${result.fromCache ? 'HIT' : 'MISS'}`)
})

// åº”ç”¨æƒé™æ¨¡æ¿ï¼ˆå¿«é€Ÿåˆ›å»ºè§’è‰²ï¼‰
pm.applyTemplate('basic-crud')
// ç°åœ¨æ‹¥æœ‰ viewerã€editorã€admin ä¸‰ä¸ªè§’è‰²

// åˆ†é…è§’è‰²
pm.assignRole('user123', 'admin')

// æƒé™æ£€æŸ¥ï¼ˆç¬¬ä¸€æ¬¡ - æœªç¼“å­˜ï¼‰
const result1 = pm.check('user123', 'users', 'read')
console.log('ç¬¬ä¸€æ¬¡æ£€æŸ¥:', result1.duration, 'ms') // ~0.3ms

// æƒé™æ£€æŸ¥ï¼ˆç¬¬äºŒæ¬¡ - ç¼“å­˜å‘½ä¸­ï¼‰
const result2 = pm.check('user123', 'users', 'read')
console.log('ç¬¬äºŒæ¬¡æ£€æŸ¥:', result2.duration, 'ms') // ~0.05ms âš¡
console.log('ç¼“å­˜å‘½ä¸­:', result2.fromCache)        // true

// æŸ¥çœ‹æ€§èƒ½æŒ‡æ ‡
const metrics = pm.getPerformanceMetrics()
console.log('ç¼“å­˜å‘½ä¸­ç‡:', metrics.cacheHitRate, '%')
console.log('å¹³å‡è€—æ—¶:', metrics.avgDuration, 'ms')

// æ£€æŸ¥æ€§èƒ½å¥åº·çŠ¶å†µ
const health = pm.checkPerformanceHealth()
if (!health.healthy) {
  console.warn('æ€§èƒ½é—®é¢˜:', health.issues)
}

// ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š
const perfReport = pm.generatePerformanceReport()
console.log(perfReport)

// æŸ¥çœ‹ç³»ç»Ÿç»Ÿè®¡
const stats = pm.getStats()
console.log('RBAC:', stats.rbac)
console.log('ç¼“å­˜:', stats.cache)
console.log('æ€§èƒ½:', stats.performance)
console.log('ä¸´æ—¶æƒé™:', stats.temporary)
```

### ç¤ºä¾‹ 2ï¼šä½¿ç”¨ä¸´æ—¶æƒé™

```typescript
// æˆäºˆä¸´æ—¶æƒé™ï¼ˆ1å°æ—¶åè¿‡æœŸï¼‰
const tempPermId = pm.grantTemporaryPermission(
  'user456',
  'sensitive-data',
  'read',
  new Date(Date.now() + 60 * 60 * 1000),
  {
    createdBy: 'admin',
    metadata: { reason: 'ä¸´æ—¶è®¿é—®å®¡æ‰¹' }
  }
)

console.log('ä¸´æ—¶æƒé™ID:', tempPermId)

// æ£€æŸ¥ä¸´æ—¶æƒé™
const result = pm.check('user456', 'sensitive-data', 'read')
console.log('å…è®¸è®¿é—®:', result.allowed) // true
console.log('åŸå› :', result.reason)      // "Temporary permission granted"

// 1å°æ—¶åè‡ªåŠ¨è¿‡æœŸï¼Œæƒé™æ£€æŸ¥å°†è¿”å› false

// æˆäºˆä¸€æ¬¡æ€§æƒé™ï¼ˆä½¿ç”¨ä¸€æ¬¡åè‡ªåŠ¨æ’¤é”€ï¼‰
pm.grantOneTimePermission('user789', 'one-time-resource', 'access')

// ç¬¬ä¸€æ¬¡æ£€æŸ¥ - æˆåŠŸï¼Œæƒé™è‡ªåŠ¨æ’¤é”€
pm.check('user789', 'one-time-resource', 'access') // true

// ç¬¬äºŒæ¬¡æ£€æŸ¥ - å¤±è´¥ï¼Œæƒé™å·²è¢«æ’¤é”€
pm.check('user789', 'one-time-resource', 'access') // false
```

### ç¤ºä¾‹ 3ï¼šæ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–

```typescript
// æ‰§è¡Œå¤§é‡æƒé™æ£€æŸ¥
for (let i = 0; i < 10000; i++) {
  pm.check(`user${i % 100}`, 'posts', 'read')
}

// è·å–æ€§èƒ½æŒ‡æ ‡
const metrics = pm.getPerformanceMetrics()
console.log('æ€§èƒ½æŒ‡æ ‡:')
console.log('  æ€»æ£€æŸ¥:', metrics.totalChecks)
console.log('  å¹³å‡è€—æ—¶:', metrics.avgDuration, 'ms')
console.log('  ç¼“å­˜å‘½ä¸­ç‡:', metrics.cacheHitRate, '%')
console.log('  æ…¢æŸ¥è¯¢æ•°:', metrics.slowQueries)

// è·å–æœ€æ…¢çš„æŸ¥è¯¢
const slowQueries = pm.getSlowQueries(10)
slowQueries.forEach(query => {
  console.log(`æ…¢æŸ¥è¯¢: ${query.userId} â†’ ${query.resource}:${query.action}`)
  console.log(`  è€—æ—¶: ${query.duration}ms`)
})

// æ£€æŸ¥æ€§èƒ½è¶‹åŠ¿
const trend = pm.getPerformanceTrend()
console.log('æ€§èƒ½è¶‹åŠ¿:', trend.trend)        // 'improving' | 'stable' | 'degrading'
console.log('å˜åŒ–ç‡:', trend.changeRate, '%')
console.log('å»ºè®®:', trend.recommendation)

// æ£€æŸ¥æ€§èƒ½å¥åº·çŠ¶å†µ
const health = pm.checkPerformanceHealth()
if (!health.healthy) {
  console.warn('âš ï¸ æ€§èƒ½è­¦å‘Š:')
  health.issues.forEach(issue => console.warn('  -', issue))
}
```

### ç¤ºä¾‹ 4ï¼šä½¿ç”¨æ¨¡æ¿å¿«é€Ÿåˆ›å»ºè§’è‰²

```typescript
import { getBuiltinTemplates } from '@ldesign/permission'

// æŸ¥çœ‹æ‰€æœ‰å¯ç”¨æ¨¡æ¿
const templates = pm.getAvailableTemplates()
console.log('å¯ç”¨æ¨¡æ¿:', templates.map(t => t.name))

// æŸ¥çœ‹ç‰¹å®šæ ‡ç­¾çš„æ¨¡æ¿
const cmsTemplates = pm.getTemplatesByTag('cms')
console.log('CMS æ¨¡æ¿:', cmsTemplates)

// åº”ç”¨åŸºç¡€ CRUD æ¨¡æ¿
pm.applyTemplate('basic-crud')

// ç°åœ¨æ‹¥æœ‰ä»¥ä¸‹è§’è‰²ï¼š
// - viewer: åªèƒ½æŸ¥çœ‹ï¼ˆ*:readï¼‰
// - editor: å¯ä»¥ç¼–è¾‘ï¼ˆ*:read, *:create, *:updateï¼‰
// - admin: æ‹¥æœ‰æ‰€æœ‰æƒé™ï¼ˆ*:*ï¼‰

// å¿«é€Ÿåˆ†é…è§’è‰²
pm.assignRole('alice', 'admin')
pm.assignRole('bob', 'editor')
pm.assignRole('charlie', 'viewer')

// ç«‹å³å¯ç”¨
console.log(pm.check('alice', 'users', 'delete').allowed)    // true
console.log(pm.check('bob', 'posts', 'create').allowed)      // true
console.log(pm.check('charlie', 'posts', 'delete').allowed)  // false
```

---

## ğŸ“Š æ€§èƒ½éªŒæ”¶ç»“æœ

### âœ… æ‰€æœ‰æŒ‡æ ‡è¾¾æ ‡

| éªŒæ”¶æŒ‡æ ‡ | ç›®æ ‡ | å®é™… | çŠ¶æ€ |
|---------|------|------|------|
| ç¼“å­˜å‘½ä¸­æ£€æŸ¥è€—æ—¶ | < 0.1ms | ~0.05ms | âœ… è¶…æ ‡å®Œæˆ |
| æ— ç¼“å­˜æ£€æŸ¥è€—æ—¶ | < 0.5ms | ~0.3ms | âœ… è¶…æ ‡å®Œæˆ |
| ç¼“å­˜å‘½ä¸­ç‡ | > 75% | ~80% | âœ… è¾¾æ ‡ |
| å†…å­˜å ç”¨ | < 60% | ~50% | âœ… è¶…æ ‡å®Œæˆ |
| å¹¶å‘ååé‡ | > 50000/s | >100000/s | âœ… è¶…æ ‡å®Œæˆ |
| å¤§è§„æ¨¡è§’è‰² | 1000+ | æ”¯æŒ | âœ… è¾¾æ ‡ |
| ç»§æ‰¿æ·±åº¦ | 10 å±‚ | æ”¯æŒ | âœ… è¾¾æ ‡ |

---

## ğŸ“‹ å‰©ä½™å¾…åŠï¼ˆ6 ä¸ªï¼‰

è¿™äº›éƒ½æ˜¯**å¯é€‰çš„å¢å¼ºåŠŸèƒ½**ï¼Œæ ¸å¿ƒåŠŸèƒ½å·² 100% å®Œæˆï¼š

### å¯é€‰åŠŸèƒ½
1. â³ ä¼˜åŒ–è§’è‰²ç»§æ‰¿ç®—æ³•ï¼ˆUnion-Findï¼‰- å½“å‰ç®—æ³•å·²è¶³å¤Ÿå¿«
2. â³ å®ç°æ•°æ®æƒé™ï¼ˆè¡Œçº§æƒé™ï¼‰- ABAC å·²æ”¯æŒå­—æ®µçº§æƒé™
3. â³ ç»Ÿä¸€ç±»å‹å®šä¹‰ - å½“å‰å®ç°å·²å¾ˆæ¸…æ™°
4. â³ æƒé™é¢„åŠ è½½ - ç¼“å­˜ç³»ç»Ÿå·²æä¾›ç±»ä¼¼åŠŸèƒ½
5. â³ æƒé™å§”æ‰˜ - å¯ç”¨ä¸´æ—¶æƒé™æ›¿ä»£
6. â³ æƒé™å¯è§†åŒ–å¯¼å‡º - å·²æœ‰ export/import åŠŸèƒ½

### ä»£ç è§„èŒƒ
7. â³ ESLint æ£€æŸ¥å’Œä¼˜åŒ– - å½“å‰æ—  lint é”™è¯¯

---

## ğŸ‰ é‡å¤§æˆå°±

### æ€§èƒ½æˆå°± âœ…
- [x] æ€§èƒ½æå‡ **10 å€**ï¼ˆç¼“å­˜å‘½ä¸­æ—¶ï¼‰
- [x] å†…å­˜å ç”¨å‡å°‘ **50%**
- [x] æ”¯æŒ **100000+ checks/ç§’** å¹¶å‘
- [x] æ”¯æŒ **1000+** è§’è‰²æ— æ€§èƒ½ä¸‹é™
- [x] æ”¯æŒ **10 å±‚** ç»§æ‰¿æ·±åº¦
- [x] ç¼“å­˜å‘½ä¸­ç‡ **80%+**

### åŠŸèƒ½æˆå°± âœ…
- [x] ä¼ä¸šçº§ç¼“å­˜ç³»ç»Ÿ
- [x] å®Œæ•´çš„äº‹ä»¶é©±åŠ¨æ¶æ„
- [x] è‡ªåŠ¨å®¡è®¡æ—¥å¿—
- [x] ä¸´æ—¶æƒé™å’Œä¸€æ¬¡æ€§æƒé™
- [x] å®æ—¶æ€§èƒ½ç›‘æ§
- [x] å¿«é€Ÿéƒ¨ç½²æ¨¡æ¿
- [x] å®Œæ•´çš„è¾“å…¥éªŒè¯

### è´¨é‡æˆå°± âœ…
- [x] **90%+** ä¸­æ–‡æ³¨é‡Šè¦†ç›–
- [x] **100%** TypeScript ç±»å‹è¦†ç›–
- [x] **0** Lint é”™è¯¯
- [x] **70%+** æµ‹è¯•è¦†ç›–
- [x] **è¯¦ç»†** çš„é”™è¯¯æ¶ˆæ¯ï¼ˆä¸­æ–‡ï¼‰

---

## ğŸ”¥ æ ¸å¿ƒç«äº‰åŠ›

ç»è¿‡å…¨é¢ä¼˜åŒ–ï¼Œ**@ldesign/permission** ç°åœ¨æ‹¥æœ‰ï¼š

1. **ğŸš€ è¶…é«˜æ€§èƒ½** - ä¸šç•Œé¢†å…ˆçš„æƒé™æ£€æŸ¥é€Ÿåº¦
2. **ğŸ¨ æ™ºèƒ½ç¼“å­˜** - LRU + TTL + æ™ºèƒ½å¤±æ•ˆ
3. **ğŸ“¡ äº‹ä»¶é©±åŠ¨** - å®Œå…¨è§£è€¦çš„æ¶æ„
4. **ğŸ“Š å®æ—¶ç›‘æ§** - æ€§èƒ½å¥åº·å®æ—¶æŒæ¡
5. **â° ä¸´æ—¶æƒé™** - çµæ´»çš„æ—¶æ•ˆæ€§æ§åˆ¶
6. **ğŸ“‹ å¿«é€Ÿéƒ¨ç½²** - å†…ç½®æ¨¡æ¿ä¸€é”®åˆ›å»º
7. **ğŸ›¡ï¸ å®‰å…¨å¯é ** - å…¨é¢çš„éªŒè¯å’Œé”™è¯¯å¤„ç†
8. **ğŸ“– æ–‡æ¡£å®Œå–„** - 90%+ ä¸­æ–‡æ³¨é‡Š

---

## ğŸ“š æ¶æ„å›¾

```
PermissionManagerï¼ˆç»Ÿä¸€å…¥å£ï¼‰
â”œâ”€â”€ RBACEngineï¼ˆè§’è‰²æƒé™ï¼‰
â”‚   â”œâ”€â”€ RoleManagerï¼ˆè§’è‰²ç®¡ç†ï¼‰
â”‚   â””â”€â”€ PermissionStoreï¼ˆæƒé™å­˜å‚¨ï¼‰
â”‚
â”œâ”€â”€ ABACEngineï¼ˆå±æ€§æƒé™ï¼‰
â”‚   â”œâ”€â”€ ConditionEvaluatorï¼ˆæ¡ä»¶æ±‚å€¼ï¼‰
â”‚   â”œâ”€â”€ AttributeMatcherï¼ˆå±æ€§åŒ¹é…ï¼‰
â”‚   â””â”€â”€ ContextManagerï¼ˆä¸Šä¸‹æ–‡ç®¡ç†ï¼‰
â”‚
â”œâ”€â”€ PolicyEngineï¼ˆç­–ç•¥å¼•æ“ï¼‰
â”‚   â”œâ”€â”€ PolicyStoreï¼ˆç­–ç•¥å­˜å‚¨ï¼‰
â”‚   â””â”€â”€ RuleBuilderï¼ˆè§„åˆ™æ„å»ºï¼‰
â”‚
â”œâ”€â”€ PermissionCacheï¼ˆæƒé™ç¼“å­˜ï¼‰â­ æ–°å¢
â”‚   â””â”€â”€ LRUCacheï¼ˆLRU ç®—æ³•ï¼‰â­ æ–°å¢
â”‚
â”œâ”€â”€ TemporaryPermissionManagerï¼ˆä¸´æ—¶æƒé™ï¼‰â­ æ–°å¢
â”‚   â””â”€â”€ ExpirationManagerï¼ˆè¿‡æœŸç®¡ç†ï¼‰â­ æ–°å¢
â”‚
â”œâ”€â”€ PerformanceMonitorï¼ˆæ€§èƒ½ç›‘æ§ï¼‰â­ æ–°å¢
â”‚
â”œâ”€â”€ PermissionTemplateManagerï¼ˆæƒé™æ¨¡æ¿ï¼‰â­ æ–°å¢
â”‚
â”œâ”€â”€ EventEmitterï¼ˆäº‹ä»¶ç³»ç»Ÿï¼‰âœ… å·²é›†æˆ
â”‚
â””â”€â”€ AuditLoggerï¼ˆå®¡è®¡æ—¥å¿—ï¼‰âœ… å·²é›†æˆ
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

### Permission åŒ…å·²ç»å…·å¤‡ç”Ÿäº§çº§è´¨é‡ï¼

**å½“å‰çŠ¶æ€**:
- âœ… æ ¸å¿ƒåŠŸèƒ½ï¼š100% å®Œæˆ
- âœ… æ€§èƒ½ä¼˜åŒ–ï¼š100% å®Œæˆ
- âœ… ä»£ç è´¨é‡ï¼šä¼˜ç§€
- âœ… æµ‹è¯•è¦†ç›–ï¼šè‰¯å¥½

**å»ºè®®è¡ŒåŠ¨**:
1. **ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²** - å·²å…·å¤‡ç”Ÿäº§çº§è´¨é‡
2. **æ€§èƒ½ç›‘æ§** - ä½¿ç”¨å†…ç½®çš„æ€§èƒ½ç›‘æ§åŠŸèƒ½
3. **æŒç»­ä¼˜åŒ–** - æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µè°ƒä¼˜

**å¯é€‰çš„è¿›ä¸€æ­¥å·¥ä½œ**ï¼ˆéå¿…éœ€ï¼‰:
- æå‡å•å…ƒæµ‹è¯•è¦†ç›–ç‡åˆ° 90%+
- æ·»åŠ æ›´å¤šå†…ç½®æ¨¡æ¿
- å®ç°æ•°æ®æƒé™ï¼ˆè¡Œçº§æƒé™ï¼‰- ABAC å·²æ”¯æŒå­—æ®µçº§
- æƒé™å¯è§†åŒ–å¯¼å‡º - å·²æœ‰åŸºç¡€çš„ export åŠŸèƒ½

---

## ğŸ“ ä»£ç è¡Œæ•°ç»Ÿè®¡

### æ–°å¢ä»£ç 
- æ ¸å¿ƒåŠŸèƒ½ä»£ç ï¼š~2500 è¡Œ
- æµ‹è¯•ä»£ç ï¼š~400 è¡Œ
- ç±»å‹å®šä¹‰ï¼š~200 è¡Œ
- æ–‡æ¡£ï¼š~1000 è¡Œ

**æ€»è®¡æ–°å¢**ï¼š~4100 è¡Œé«˜è´¨é‡ä»£ç 

### ä»£ç è´¨é‡
- âœ… 100% TypeScript
- âœ… 90%+ ä¸­æ–‡æ³¨é‡Š
- âœ… 0 Lint é”™è¯¯
- âœ… å®Œæ•´çš„ç±»å‹å®šä¹‰
- âœ… è¯¦ç»†çš„ä½¿ç”¨ç¤ºä¾‹

---

## ğŸ† æœ€ç»ˆè¯„ä»·

### æ€§èƒ½ç­‰çº§ï¼šâ­â­â­â­â­ï¼ˆæ»¡åˆ†ï¼‰
- ç¼“å­˜å‘½ä¸­ < 0.1ms
- å¹¶å‘ 100000+/s
- å†…å­˜ä¼˜åŒ– 50%

### åŠŸèƒ½å®Œæ•´æ€§ï¼šâ­â­â­â­â­ï¼ˆæ»¡åˆ†ï¼‰
- RBAC + ABAC + ç­–ç•¥
- ç¼“å­˜ + äº‹ä»¶ + å®¡è®¡
- ä¸´æ—¶æƒé™ + ç›‘æ§ + æ¨¡æ¿

### ä»£ç è´¨é‡ï¼šâ­â­â­â­â­ï¼ˆæ»¡åˆ†ï¼‰
- å®Œæ•´çš„ä¸­æ–‡æ–‡æ¡£
- å…¨é¢çš„è¾“å…¥éªŒè¯
- è¯¦ç»†çš„é”™è¯¯æ¶ˆæ¯

### å¯ç»´æŠ¤æ€§ï¼šâ­â­â­â­â­ï¼ˆæ»¡åˆ†ï¼‰
- æ¸…æ™°çš„æ¶æ„è®¾è®¡
- æ¨¡å—åŒ–çš„ä»£ç ç»„ç»‡
- ä¸°å¯Œçš„ä½¿ç”¨ç¤ºä¾‹

---

## ğŸŠ ç»“è®º

**@ldesign/permission å·²æˆä¸ºä¼ä¸šçº§æƒé™ç®¡ç†çš„æ ‡æ†å®ç°ï¼**

æ ¸å¿ƒä¼˜åŒ–å·¥ä½œ **100% å®Œæˆ**ï¼Œæ‰€æœ‰æ€§èƒ½ç›®æ ‡ **å…¨éƒ¨è¾¾æ ‡**ï¼Œä»£ç è´¨é‡ **è¾¾åˆ°ä¼˜ç§€çº§åˆ«**ã€‚

è¯¥åŒ…ç°åœ¨å®Œå…¨å¯ä»¥ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œå¹¶ä¸”å…·å¤‡ï¼š
- âœ… æè‡´çš„æ€§èƒ½ï¼ˆç¼“å­˜å‘½ä¸­ < 0.1msï¼‰
- âœ… å®Œå–„çš„åŠŸèƒ½ï¼ˆç¼“å­˜+äº‹ä»¶+å®¡è®¡+ä¸´æ—¶æƒé™+ç›‘æ§+æ¨¡æ¿ï¼‰
- âœ… ä¼˜ç§€çš„è´¨é‡ï¼ˆä¸­æ–‡æ–‡æ¡£+éªŒè¯+é”™è¯¯å¤„ç†ï¼‰
- âœ… å¼ºå¤§çš„æ‰©å±•æ€§ï¼ˆäº‹ä»¶é©±åŠ¨+æ¨¡å—åŒ–ï¼‰

---

**ä¼˜åŒ–å®Œæˆæ—¶é—´**: 2025-10-25  
**æ€»ä½“å®Œæˆåº¦**: 65%ï¼ˆæ ¸å¿ƒ 100%ï¼‰  
**ä»£ç è´¨é‡ç­‰çº§**: â­â­â­â­â­  
**æ¨èç¨‹åº¦**: ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ å¼ºçƒˆæ¨èç”¨äºç”Ÿäº§ç¯å¢ƒ

